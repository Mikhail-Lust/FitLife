<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitLife - –ù–∞—Å—Ç—Ä–æ–π–∫–∏</title>
  <link rel="stylesheet" href="../styles/settings_html.css">
</head>
<body>
  <header>
    <div class="profile">
      <img src="https://i.pravatar.cc/45" class="profile-img" id="userPhoto" alt="–ü—Ä–æ—Ñ–∏–ª—å">
      <span id="username">–ì–æ—Å—Ç—å</span>
    </div>
    <div class="burger" onclick="toggleMenu()">‚ò∞</div>
  </header>

  <nav class="menu" id="menu">
    <a href="index.html" onclick="closeMenu()">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    <a href="diet.html" onclick="closeMenu()">ü•ó –î–∏–µ—Ç–∞</a>
    <a href="workout.html" onclick="closeMenu()">üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a>
    <a href="progress.html" onclick="closeMenu()">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</a>
    <a href="settings.html" onclick="closeMenu()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
  </nav>

  <main class="main">
    <div class="settings-list">
      <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
      
      <div class="setting-item">
        <div>
          <h3>–¢–µ–º–Ω–∞—è —Ç–µ–º–∞</h3>
          <p>–í–∫–ª—é—á–∏—Ç—å –Ω–æ—á–Ω–æ–π —Ä–µ–∂–∏–º</p>
        </div>
        <label class="switch">
          <input type="checkbox" id="darkTheme">
          <span class="slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
          <p>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
        </div>
        <label class="switch">
          <input type="checkbox" id="notifications">
          <span class="slider"></span>
        </label>
      </div>

      <div class="setting-item">
        <div>
          <h3>–ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è</h3>
          <p>–ú–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ (–∫–≥/—Å–º)</p>
        </div>
        <label class="switch">
          <input type="checkbox" id="units">
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </main>

  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK
    vkBridge.send('VKWebAppInit');

    // –§—É–Ω–∫—Ü–∏–∏ –º–µ–Ω—é
    function toggleMenu() {
      document.getElementById('menu').classList.toggle('active');
    }

    function closeMenu() {
      document.getElementById('menu').classList.remove('active');
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    async function fetchUserData() {
      try {
        const user = await vkBridge.send('VKWebAppGetUserInfo');
        document.getElementById('username').textContent = `${user.first_name} ${user.last_name}`;
        document.getElementById('userPhoto').src = user.photo_100 || 'https://i.pravatar.cc/45';
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
        document.getElementById('userPhoto').src = 'https://i.pravatar.cc/45';
        document.getElementById('username').textContent = '–ì–æ—Å—Ç—å';
      }
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ–º—ã
    function loadSettings() {
      return {
        darkTheme: localStorage.getItem('theme') === 'dark',
        notifications: localStorage.getItem('notifications') === 'true',
        units: localStorage.getItem('units') === 'metric'
      };
    }

    function applySettings() {
      const settings = loadSettings();
      document.documentElement.setAttribute('data-theme', settings.darkTheme ? 'dark' : 'light');
      document.getElementById('darkTheme').checked = settings.darkTheme;
      document.getElementById('notifications').checked = settings.notifications;
      document.getElementById('units').checked = settings.units;
    }

    document.getElementById('darkTheme').addEventListener('change', function(e) {
      localStorage.setItem('theme', e.target.checked ? 'dark' : 'light');
      document.documentElement.setAttribute('data-theme', e.target.checked ? 'dark' : 'light');
    });

    document.getElementById('notifications').addEventListener('change', function(e) {
      localStorage.setItem('notifications', e.target.checked);
    });

    document.getElementById('units').addEventListener('change', function(e) {
      localStorage.setItem('units', e.target.checked ? 'metric' : 'imperial');
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.addEventListener('DOMContentLoaded', () => {
      // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      if(!localStorage.getItem('theme')) localStorage.setItem('theme', 'light');
      if(!localStorage.getItem('notifications')) localStorage.setItem('notifications', 'true');
      if(!localStorage.getItem('units')) localStorage.setItem('units', 'metric');
      
      fetchUserData();
      applySettings();
    });
    
  
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Mini Apps
vkBridge.send('VKWebAppInit');

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function fetchUserData() {
  try {
    const user = await vkBridge.send('VKWebAppGetUserInfo');
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤–∞—Ç–∞—Ä–∫—É
    const userPhoto = document.getElementById('userPhoto');
    userPhoto.src = user.photo_200 || 'https://vk.com/images/camera_200.png';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è
    const username = document.getElementById('username');
    username.textContent = `${user.first_name} ${user.last_name}`;
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
    console.log('User data:', user);
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:', error);
    // –ó–∞–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    document.getElementById('userPhoto').src = 'https://vk.com/images/camera_200.png';
    document.getElementById('username').textContent = '–ì–æ—Å—Ç—å';
  }
}

// –í—ã–∑—ã–≤–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('DOMContentLoaded', () => {
  fetchUserData();
  // –û—Å—Ç–∞–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...
});
  </script>
</body>
</html>