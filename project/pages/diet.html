<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitLife - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–µ—Ç–æ–π</title>
  <link rel="stylesheet" href="../styles/diet_html.css">
</head>
<body>
  <header>
    <div class="profile">
      <img src="" class="profile-img" id="userPhoto" alt="–ü—Ä–æ—Ñ–∏–ª—å">
      <span id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
    <div class="burger" onclick="toggleMenu()">‚ò∞</div>
  </header>

  <nav class="menu" id="menu">
    <a href="index.html" onclick="closeMenu()">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    <a href="#" onclick="closeMenu()">ü•ó –î–∏–µ—Ç–∞</a>
    <a href="workout.html" onclick="closeMenu()">üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a>
    <a href="progress.html" onclick="closeMenu()">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</a>
    <a href="settings.html" onclick="closeMenu()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
  </nav>

  <main class="main">
    <section class="diet-section">
      <div id="dietChoice">
        <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –¥–∏–µ—Ç—É</h2>
        <div class="diet-cards">
          <div class="diet-card" onclick="selectDiet('balanced')">
            <h3>–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è üçé</h3>
            <p>2000-2500 –∫–∫–∞–ª/–¥–µ–Ω—å</p>
            <p>–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ë–ñ–£</p>
          </div>
          <div class="diet-card" onclick="selectDiet('lowcarb')">
            <h3>–ù–∏–∑–∫–æ—É–≥–ª–µ–≤–æ–¥–Ω–∞—è ü•ë</h3>
            <p>1500-1800 –∫–∫–∞–ª/–¥–µ–Ω—å</p>
            <p>–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –±–µ–ª–∫–∏ –∏ –∂–∏—Ä—ã</p>
          </div>
          <div class="diet-card" onclick="selectDiet('vegetarian')">
            <h3>–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∞—è üå±</h3>
            <p>1800-2200 –∫–∫–∞–ª/–¥–µ–Ω—å</p>
            <p>–†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –±–µ–ª–∫–∏ –∏ –∫–ª–µ—Ç—á–∞—Ç–∫–∞</p>
          </div>
        </div>
      </div>

      <div id="currentDiet" style="display: none;">
        <div class="diet-details">
          <h2 id="dietTitle">–¢–µ–∫—É—â–∞—è –¥–∏–µ—Ç–∞: –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è üçé</h2>
          <div class="update-info">
            <p>–°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="nextUpdateDate"></span></p>
          </div>
          <div class="diet-description">
            <p id="dietDescription">–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –±–µ–ª–∫–æ–≤, –∂–∏—Ä–æ–≤ –∏ —É–≥–ª–µ–≤–æ–¥–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏.</p>
          </div>
          
          <div class="day-selector" id="daySelector"></div>

          <div class="nutri-facts">
            <div class="nutri-item">
              <div class="nutri-value" id="dailyCalories">2000</div>
              <div>–∫–∫–∞–ª/–¥–µ–Ω—å</div>
            </div>
            <div class="nutri-item">
              <div class="nutri-value" id="bjuRatio">50-30-20</div>
              <div>–ë–ñ–£ %</div>
            </div>
            <div class="nutri-item">
              <div class="nutri-value" id="mealsCount">5</div>
              <div>–ü—Ä–∏—ë–º–æ–≤ –ø–∏—â–∏</div>
            </div>
          </div>

          <h3>–†–∞—Ü–∏–æ–Ω –Ω–∞ <span id="currentDay">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</span>:</h3>
          <div class="meal-plan" id="mealPlan"></div>

          <div class="change-diet">
            <button class="btn" onclick="showDietChoice()">‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –¥–∏–µ—Ç—É</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
  <script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Mini Apps
    vkBridge.send('VKWebAppInit');

    // ========== VK API Integration ==========
    async function fetchUserData() {
      try {
        const user = await vkBridge.send('VKWebAppGetUserInfo');
        document.getElementById('username').textContent = `${user.first_name} ${user.last_name}`;
        document.getElementById('userPhoto').src = user.photo_200 || 'https://vk.com/images/camera_200.png';
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
        document.getElementById('userPhoto').src = 'https://vk.com/images/camera_200.png';
        document.getElementById('username').textContent = '–ì–æ—Å—Ç—å';
      }
    }

    // ========== Diet Logic ==========
    function getNextMonday(date) {
      const result = new Date(date);
      result.setDate(result.getDate() + (7 - result.getDay() + 1) % 7);
      result.setHours(0, 0, 0, 0);
      return result;
    }

    function shouldUpdateDiet(lastUpdate) {
      if (!lastUpdate) return true;
      const now = new Date();
      const nextMonday = getNextMonday(new Date(lastUpdate));
      return now >= nextMonday;
    }

    function generateNewWeeklyPlan(dietType) {
      return {
        ...diets[dietType],
        weeklyPlan: generateWeeklyMeals(dietType)
      };
    }

    const diets = {
      balanced: {
        title: '–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è üçé',
        description: '–û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ –±–µ–ª–∫–æ–≤, –∂–∏—Ä–æ–≤ –∏ —É–≥–ª–µ–≤–æ–¥–æ–≤ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –∑–¥–æ—Ä–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∂–∏–∑–Ω–∏.',
        calories: 2000,
        bju: '50-30-20',
        meals: 5,
        weeklyPlan: generateWeeklyMeals('balanced')
      },
      lowcarb: {
        title: '–ù–∏–∑–∫–æ—É–≥–ª–µ–≤–æ–¥–Ω–∞—è ü•ë',
        description: '–ê–∫—Ü–µ–Ω—Ç –Ω–∞ –±–µ–ª–∫–æ–≤—É—é –ø–∏—â—É –∏ –ø–æ–ª–µ–∑–Ω—ã–µ –∂–∏—Ä—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –∂–∏—Ä–æ—Å–∂–∏–≥–∞–Ω–∏—è.',
        calories: 1800,
        bju: '40-50-10',
        meals: 4,
        weeklyPlan: generateWeeklyMeals('lowcarb')
      },
      vegetarian: {
        title: '–í–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∞—è üå±',
        description: '–†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –±–µ–ª–∫–∏ –∏ –∫–ª–µ—Ç—á–∞—Ç–∫–∞ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ –∑–¥–æ—Ä–æ–≤—å—è.',
        calories: 2200,
        bju: '30-40-30',
        meals: 5,
        weeklyPlan: generateWeeklyMeals('vegetarian')
      }
    };

    function generateWeeklyMeals(type) {
      const days = ['–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', '–í—Ç–æ—Ä–Ω–∏–∫', '–°—Ä–µ–¥–∞', '–ß–µ—Ç–≤–µ—Ä–≥', '–ü—è—Ç–Ω–∏—Ü–∞', '–°—É–±–±–æ—Ç–∞', '–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ'];
      const mealsByType = {
        balanced: {
          breakfast: ['–û–≤—Å—è–Ω–∞—è –∫–∞—à–∞ —Å —Ñ—Ä—É–∫—Ç–∞–º–∏', '–ì—Ä–µ—á–Ω–µ–≤–∞—è –∫–∞—à–∞ —Å —è–π—Ü–æ–º', '–¢–≤–æ—Ä–æ–∂–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞'],
          lunch: ['–ì—Ä–µ—á–∫–∞ —Å –∫—É—Ä–∏—Ü–µ–π', '–†–∏—Å —Å —Ä—ã–±–æ–π', '–ü–µ—Ä–ª–æ–≤–∫–∞ —Å –∏–Ω–¥–µ–π–∫–æ–π'],
          dinner: ['–ó–∞–ø–µ—á–µ–Ω–Ω–∞—è —Ä—ã–±–∞ —Å –æ–≤–æ—â–∞–º–∏', '–ö—É—Ä–∏–Ω–∞—è –≥—Ä—É–¥–∫–∞ —Å –±—Ä–æ–∫–∫–æ–ª–∏', '–ò–Ω–¥–µ–π–∫–∞ —Å —Ç—ã–∫–≤–æ–π']
        },
        lowcarb: {
          breakfast: ['–û–º–ª–µ—Ç —Å –æ–≤–æ—â–∞–º–∏', '–¢–≤–æ—Ä–æ–≥ —Å –æ—Ä–µ—Ö–∞–º–∏', '–Ø–∏—á–Ω–∏—Ü–∞ —Å –±–µ–∫–æ–Ω–æ–º'],
          lunch: ['–°—Ç–µ–π–∫ –∏–∑ –≥–æ–≤—è–¥–∏–Ω—ã', '–ö—É—Ä–∏–Ω—ã–µ –±–µ–¥—Ä–∞ —Å —Å—ã—Ä–æ–º', '–†—ã–±–∞ –Ω–∞ –≥—Ä–∏–ª–µ'],
          dinner: ['–û–≤–æ—â–Ω–æ–µ —Ä–∞–≥—É —Å –∫—É—Ä–∏—Ü–µ–π', '–°–∞–ª–∞—Ç —Å —Ç—É–Ω—Ü–æ–º', '–ó–∞–ø–µ—á–µ–Ω–Ω—ã–µ –æ–≤–æ—â–∏']
        },
        vegetarian: {
          breakfast: ['–°–º—É–∑–∏-–±–æ—É–ª —Å —Ñ—Ä—É–∫—Ç–∞–º–∏', '–¢–æ—Ñ—É —Å–∫—Ä—ç–º–±–ª', '–û–≤—Å—è–Ω–∫–∞ –Ω–∞ —Ä–∞—Å—Ç–∏—Ç–µ–ª—å–Ω–æ–º –º–æ–ª–æ–∫–µ'],
          lunch: ['–ß–µ—á–µ–≤–∏—á–Ω—ã–π —Å—É–ø', '–û–≤–æ—â–Ω–æ–µ –∫–∞—Ä—Ä–∏ —Å —Ç–æ—Ñ—É', '–§–∞–ª–∞—Ñ–µ–ª—å —Å —Ö—É–º—É—Å–æ–º'],
          dinner: ['–û–≤–æ—â–Ω–∞—è –∑–∞–ø–µ–∫–∞–Ω–∫–∞', '–ì—Ä–µ—á–∫–∞ —Å –≥—Ä–∏–±–∞–º–∏', '–°—Ç–µ–π–∫ –∏–∑ —Ü–≤–µ—Ç–Ω–æ–π –∫–∞–ø—É—Å—Ç—ã']
        }
      };

      return days.map(day => ({
        day,
        meals: [
          { title: '–ó–∞–≤—Ç—Ä–∞–∫ ü•û', meal: randomItem(mealsByType[type].breakfast), kcal: 400 },
          { title: '–ü–µ—Ä–µ–∫—É—Å ü•ú', meal: '–ô–æ–≥—É—Ä—Ç —Å –æ—Ä–µ—Ö–∞–º–∏', kcal: 200 },
          { title: '–û–±–µ–¥ üç≤', meal: randomItem(mealsByType[type].lunch), kcal: 600 },
          { title: '–ü–æ–ª–¥–Ω–∏–∫ üçé', meal: '–§—Ä—É–∫—Ç–æ–≤—ã–π —Å–∞–ª–∞—Ç', kcal: 150 },
          { title: '–£–∂–∏–Ω üêü', meal: randomItem(mealsByType[type].dinner), kcal: 500 }
        ]
      }));
    }

    function randomItem(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function selectDiet(type) {
      localStorage.setItem('currentDiet', type);
      localStorage.setItem('lastDietUpdate', new Date().toISOString());
      loadDiet();
    }

    function loadDiet() {
      const dietType = localStorage.getItem('currentDiet');
      if (!dietType) return showDietChoice();

      const lastUpdate = localStorage.getItem('lastDietUpdate');
      if (shouldUpdateDiet(lastUpdate)) {
        diets[dietType] = generateNewWeeklyPlan(dietType);
        localStorage.setItem('lastDietUpdate', new Date().toISOString());
        console.log('–†–∞—Ü–∏–æ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ –Ω–æ–≤—É—é –Ω–µ–¥–µ–ª—é!');
      }

      const diet = diets[dietType];
      const today = new Date().getDay();
      
      document.getElementById('dietChoice').style.display = 'none';
      document.getElementById('currentDiet').style.display = 'block';
      
      document.getElementById('dietTitle').textContent = `–¢–µ–∫—É—â–∞—è –¥–∏–µ—Ç–∞: ${diet.title}`;
      document.getElementById('dietDescription').textContent = diet.description;
      document.getElementById('dailyCalories').textContent = diet.calories;
      document.getElementById('bjuRatio').textContent = diet.bju;
      document.getElementById('mealsCount').textContent = diet.meals;

      updateDaySelector(diet.weeklyPlan);
      showDayMeals(today === 0 ? 6 : today - 1);

      const nextUpdate = getNextMonday(new Date()).toLocaleDateString('ru-RU');
      document.getElementById('nextUpdateDate').textContent = nextUpdate;
    }

    function updateDaySelector(weeklyPlan) {
      const container = document.getElementById('daySelector');
      container.innerHTML = weeklyPlan.map((day, index) => `
        <button class="day-button ${index === 0 ? 'active' : ''}" 
                onclick="showDayMeals(${index})">
          ${day.day}
        </button>
      `).join('');
    }

    function showDayMeals(dayIndex) {
      const dietType = localStorage.getItem('currentDiet');
      const weeklyPlan = diets[dietType].weeklyPlan;
      
      document.querySelectorAll('.day-button').forEach((btn, index) => {
        btn.classList.toggle('active', index === dayIndex);
      });

      document.getElementById('currentDay').textContent = weeklyPlan[dayIndex].day;
      
      const mealPlan = document.getElementById('mealPlan');
      mealPlan.innerHTML = weeklyPlan[dayIndex].meals.map(meal => `
        <div class="meal-card">
          <h4>${meal.title}</h4>
          <p>${meal.meal}</p>
          <p>${meal.kcal} –∫–∫–∞–ª</p>
        </div>
      `).join('');
    }

    function showDietChoice() {
      localStorage.removeItem('currentDiet');
      document.getElementById('dietChoice').style.display = 'block';
      document.getElementById('currentDiet').style.display = 'none';
    }

    function toggleMenu() {
      document.getElementById('menu').classList.toggle('active');
    }

    function closeMenu() {
      document.getElementById('menu').classList.remove('active');
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('DOMContentLoaded', () => {
      fetchUserData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ VK
      
      if (localStorage.getItem('currentDiet')) {
        loadDiet();
      }
    });
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–º—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
  const savedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
});
  </script>
</body>
</html>