<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FitLife - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–∫–µ—Ä</title>
  <link rel="stylesheet" href="../styles/index_html.css">
  <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
</head>
<body>
    <header>
    <div class="profile">
      <img src="https://i.pravatar.cc/45" class="profile-img" alt="–ü—Ä–æ—Ñ–∏–ª—å">
      <span id="username">–ì–æ—Å—Ç—å</span>
    </div>
    <div class="burger" onclick="toggleMenu()">‚ò∞</div>
  </header>

  <nav class="menu" id="menu">
    <a href="#" onclick="closeMenu()">üè† –ì–ª–∞–≤–Ω–∞—è</a>
    <a href="diet.html" onclick="closeMenu()">ü•ó –î–∏–µ—Ç–∞</a>
    <a href="workout.html" onclick="closeMenu()">üí™ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</a>
    <a href="progress.html" onclick="closeMenu()">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å</a>
    <a href="settings.html" onclick="closeMenu()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
  </nav>

  <main class="main">
    <section class="hero">
      <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="mainUsername">–ì–æ—Å—Ç—å</span>!</h1>
      <p>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∏—Ä–µ —Ñ–∏—Ç–Ω–µ—Å–∞ –∏ –∑–¥–æ—Ä–æ–≤—å—è</p>

      <div class="btn-group">
        <button class="btn" onclick="startDiet()">ü•ó –ù–∞—á–∞—Ç—å –¥–∏–µ—Ç—É</button>
        <button class="btn" onclick="startWorkout()">üèãÔ∏è –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
        <button class="btn" onclick="showProgress()">üìä –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
      </div>
    </section>

      <section class="section">
      <div class="progress-ring">
        <svg class="progress-svg" width="150" height="150">
          <circle
            cx="75"
            cy="75"
            r="70"
            fill="none"
            stroke="#eee"
            stroke-width="10"
          />
          <circle
            cx="75"
            cy="75"
            r="70"
            fill="none"
            stroke="var(--primary)"
            stroke-width="10"
            stroke-dasharray="439.8"
            stroke-dashoffset="439.8"
            id="progressCircle"
          />
        </svg>
        <div class="progress-text">0%</div>
      </div>
    </section>

    <section class="section">
      <h2>üíß –í–æ–¥–Ω—ã–π –±–∞–ª–∞–Ω—Å</h2>
      <div class="water-tracker">
        <div class="water-bottle">
          <div class="water-fill" id="waterFill"></div>
        </div>
        <div class="btn-group">
          <button class="btn" onclick="addWater(250)">+250 –º–ª</button>
          <button class="btn" onclick="addWater(500)">+500 –º–ª</button>
        </div>
        <p>–í—ã–ø–∏—Ç–æ —Å–µ–≥–æ–¥–Ω—è: <span id="waterCount">0</span> / 2000 –º–ª</p>
      </div>
    </section>
  </main>

  <script>
  const vkBridge = window.VKBridge;
    const progressCircle = document.getElementById('progressCircle');
    const circumference = 2 * Math.PI * 70;
    let currentProgress = 0;
    let waterTotal = 0;
    const maxWater = 2000;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    progressCircle.style.strokeDasharray = circumference;
    progressCircle.style.strokeDashoffset = circumference;

    function updateProgress(percent) {
        const offset = circumference - (percent / 100) * circumference;
        progressCircle.style.strokeDashoffset = offset;
        document.querySelector('.progress-text').textContent = `${percent}%`;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    async function initializeApp() {
        try {
            // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            await vkBridge.send('VKWebAppInit');

            // 2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            const [userData, themeData, progressData, waterData] = await Promise.all([
                vkBridge.send('VKWebAppGetUserInfo'),
                vkBridge.send('VKWebAppStorageGet', { keys: ['theme'] }),
                vkBridge.send('VKWebAppStorageGet', { keys: ['progress'] }),
                vkBridge.send('VKWebAppStorageGet', { keys: ['waterTotal'] })
            ]);

            // 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updateUserInterface(userData);
            applyTheme(themeData.keys[0]?.value || 'light');
            updateProgress(parseInt(progressData.keys[0]?.value) || 0);
            initWaterTracker(parseInt(waterData.keys[0]?.value) || 0);

            // 4. –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
            animateSections();

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            showFallbackUI();
        }
    }

    function updateUserInterface(user) {
        document.getElementById('username').textContent =
            `${user.first_name} ${user.last_name}`;
        document.getElementById('mainUsername').textContent =
            `${user.first_name} ${user.last_name}`;
        document.getElementById('userPhoto').src = user.photo_200;
    }

    function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
    }

    function initWaterTracker(initialValue) {
        waterTotal = initialValue;
        updateWaterDisplay();
    }

    function updateWaterDisplay() {
        document.getElementById('waterCount').textContent = waterTotal;
        const fillHeight = (waterTotal / maxWater) * 100;
        document.getElementById('waterFill').style.height = `${fillHeight}%`;
    }

    async function addWater(amount) {
        try {
            waterTotal = Math.min(waterTotal + amount, maxWater);
            await vkBridge.send('VKWebAppStorageSet', {
                key: 'waterTotal',
                value: waterTotal.toString()
            });
            updateWaterDisplay();
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–¥—ã:', error);
        }
    }

    function animateSections() {
        document.querySelectorAll('.section').forEach((section, index) => {
            setTimeout(() => {
                section.style.opacity = '1';
                section.style.transform = 'translateY(0)';
            }, index * 200);
        });
    }

    function showFallbackUI() {
        document.getElementById('userPhoto').src = 'https://i.pravatar.cc/45';
        document.getElementById('username').textContent = '–ì–æ—Å—Ç—å';
        document.getElementById('mainUsername').textContent = '–ì–æ—Å—Ç—å';
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    window.addEventListener('DOMContentLoaded', () => {
        initializeApp().then(() => {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            window.toggleMenu = () =>
                document.getElementById('menu').classList.toggle('active');

            window.closeMenu = () =>
                document.getElementById('menu').classList.remove('active');

            window.startDiet = () =>
                alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–±–æ—Ä–∞ –¥–∏–µ—Ç—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ ü•ó');

            window.startWorkout = () =>
                alert('–§—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üí™');

            window.showProgress = () =>
                alert('–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è —Å–∫–æ—Ä–æ üìä');
        });
    });
  </script>
</body>
</html>